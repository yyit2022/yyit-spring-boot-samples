= ç¼–å†™å•å…ƒæµ‹è¯•ï¼šæœåŠ¡å±‚


åœ¨è¿™ä¸€å±‚ï¼Œæˆ‘ä»¬å°†éš”ç¦»æœåŠ¡å±‚å¹¶æµ‹è¯•æœåŠ¡æ–¹æ³•ã€‚æ¨¡æ‹Ÿæ³¨è§£å°†åˆ›å»ºä¸€ä¸ªæœåŠ¡å±‚çš„æ¨¡æ‹Ÿå¯¹è±¡ã€‚
å¦‚å‰æ‰€è¿°ï¼Œè¿™é‡Œä¹Ÿä½¿ç”¨ *ExtendWith* æ‰©å±•æ¥æ¨¡æ‹Ÿæµ‹è¯•ç¯å¢ƒã€‚

[source,java]
----
@ExtendWith(SpringExtension.class)
public class OrderServiceUnitTest {

    @Mock
    private OrderService orderService;

}
----

ğŸ‘‰ âœ”ï¸ è®©æˆ‘ä»¬ä¸ºè·å–è®¢å•çš„æ–¹æ³•ç¼–å†™ä¸€ä¸ªæµ‹è¯•ã€‚


æˆ‘åˆ›å»ºäº† 2 ä¸ªè®¢å•å¹¶æ·»åŠ åˆ°åˆ—è¡¨ä¸­ã€‚ç„¶åæˆ‘ä½¿ç”¨ Mockito *when()* å­å¥æ¥æ¨¡æ‹Ÿè¡Œä¸ºã€‚


ä¸‹ä¸€éƒ¨åˆ†åœ¨è¿™é‡Œæœ‰æ‰€ä¸åŒã€‚æˆ‘ä»¬åœ¨æœåŠ¡å±‚æµ‹è¯•ä¸­ä½¿ç”¨ *Junit Assertions*ã€‚
æˆ‘ä»¬å¯ä»¥æ–­è¨€ç›¸ç­‰/ ä¸ç›¸ç­‰/ NULL åœºæ™¯ã€‚*ç¬¬ä¸€ä¸ªå‚æ•°æ€»æ˜¯æœŸæœ›å€¼*ï¼Œ*ç¬¬äºŒä¸ªæ˜¯å®é™…å€¼*ã€‚

æˆ‘ä»¬åœ¨è¿™é‡Œä¸éœ€è¦ MockMvcï¼Œå› ä¸ºè¿™æ˜¯ä» web å±‚ä¸‹é™äº†ä¸€æ­¥ã€‚

[source,java]
----
@Test
public void testGetOrdersList() {
    Order order1 = new Order(8L, "ben", 80.0, 5);
    Order order2 = new Order(9L, "kevin", 70.0, 2);
    when(orderService.getOrders()).thenReturn(Arrays.asList(order1, order2));
    assertEquals(orderService.getOrders().size(), 2);
    assertEquals(orderService.getOrders().get(0).getBuyer(), "ben");
    assertEquals(orderService.getOrders().get(1).getBuyer(), "kevin");
    assertEquals(orderService.getOrders().get(0).getPrice(), 80.0);
    assertEquals(orderService.getOrders().get(1).getPrice(), 70.0);
    assertNotEquals(orderService.getOrders().get(0).getBuyer(), null);
    assertNotEquals(orderService.getOrders().get(1).getBuyer(), null);
}
----

ğŸ‘‰ âœ”ï¸ è®©æˆ‘ä»¬ä¸º**é€šè¿‡ ID è·å– Order** çš„æ–¹æ³•ç¼–å†™ä¸€ä¸ªæœåŠ¡æµ‹è¯•ã€‚æ²¡æœ‰ä»€ä¹ˆæ–°ä¸œè¥¿ã€‚è¯·å‚é˜…ä¸‹é¢çš„ä»£ç ã€‚ä¸€æ ·çš„ä¸œè¥¿ï¼ï¼ä¸æ˜¯å—ï¼Ÿ

[source,java]
----
@Test
public void testGetOrderById() {
    Order order = new Order(7L, "george", 60.0, 6);
    when(orderService.getOrderById(7L)).thenReturn(order);
    assertEquals(orderService.getOrderById(7L).getBuyer(), "george");
    assertEquals(orderService.getOrderById(7L).getPrice(), 60.0);
    assertNotEquals(orderService.getOrderById(7L).getBuyer(), null);
}
----

ğŸ‘‰ âœ”ï¸ è®©æˆ‘ä»¬ç¼–å†™ä¸€ä¸ªç”¨äº**è·å–æ— æ•ˆè®¢å•**çš„æœåŠ¡æµ‹è¯•ã€‚
é‚£é‡Œæˆ‘ä»¬å¿…é¡»**æœŸæœ›ä¸€ä¸ª OrderNotFoundException** å› ä¸º ID åœ¨æ•°æ®åº“ä¸­ä¸å¯ç”¨ã€‚
è¿™æ˜¯ä¸€ä¸ªå¦å®šçš„æµ‹è¯•ç”¨ä¾‹ã€‚
åœ¨è¿™é‡Œï¼Œ*assertThrows()* å¯ç”¨äºæ•…æ„æŠ›å‡ºå¼‚å¸¸ï¼Œå¹¶å°†å…¶ä¸å¼‚å¸¸æ¶ˆæ¯ä¸­çš„å®é™…å€¼è¿›è¡Œæ¯”è¾ƒã€‚
æˆ‘å·²ç»æ£€æŸ¥äº†å­—ç¬¦ä¸²æ¶ˆæ¯å†…å®¹çš„ç›¸ç­‰æ€§ã€‚

[source,java]
----
@Test
public void testGetInvalidOrderById() {
    when(orderService.getOrderById(17L)).thenThrow(new OrderNotFoundException("Order Not Found with ID"));
    Exception exception = assertThrows(OrderNotFoundException.class, () -> {
        orderService.getOrderById(17L);
    });
    assertTrue(exception.getMessage().contains("Order Not Found with ID"));
}
----

ğŸ‘‰ âœ”ï¸è®©æˆ‘ä»¬ç¼–å†™ä¸€ä¸ªç”¨äº**åˆ›å»ºæ–°è®¢å•**çš„æœåŠ¡æµ‹è¯•ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæœ‰ä¸€äº›æ–°çš„ä¸œè¥¿è¦å­¦ä¹ ! ğŸ˜

[source,java]
----
@Test
public void testCreateOrder() {
    Order order = new Order(12L, "john", 90.0, 6);
    orderService.createOrder(order);
    verify(orderService, times(1)).createOrder(order);
    ArgumentCaptor<Order> orderArgumentCaptor = ArgumentCaptor.forClass(Order.class);
    verify(orderService).createOrder(orderArgumentCaptor.capture());
    Order orderCreated = orderArgumentCaptor.getValue();
    assertNotNull(orderCreated.getId());
    assertEquals("john", orderCreated.getBuyer());
}
----

åœ¨è¿™é‡Œï¼Œæˆ‘åƒä»¥å‰ä¸€æ ·çœç•¥äº† *when()* å­å¥ã€‚æˆ‘ä»¬åªéœ€è¦è°ƒç”¨è¯¥æ–¹æ³•ï¼Œå› ä¸º create æ–¹æ³•æ²¡æœ‰è¿”å›ä»»ä½•ä¸œè¥¿(void)ã€‚

Mockito æä¾› *verify()* æ–¹æ³•æ¥ç¡®ä¿æ–¹æ³•è°ƒç”¨çš„è¡Œä¸ºã€‚

[source,java]
----
verify(orderService, times(1)).createOrder(order);
----

ä¸Šé¢ä¸€è¡Œå¯ä»¥éªŒè¯è¯¥**æ–¹æ³•åªè¢«è°ƒç”¨äº†ä¸€æ¬¡**ï¼

*ArgumentCaptor* ç”¨äº**æ•è·æ¨¡æ‹Ÿæ–¹æ³•çš„å‚æ•°**ã€‚ç”±äº POST API è°ƒç”¨è¿”å›ä¸€ä¸ªè®¢å•å¯¹è±¡ï¼Œå› æ­¤æˆ‘æä¾›äº† ArgumentCaptor ç±»å‹ä½œä¸ºè®¢å•ã€‚

[source,java]
----
verify(orderService).createOrder(orderArgumentCaptor.capture());
----

ä¸Šè¿°è¡Œå°†éªŒè¯æ¨¡æ‹ŸæœåŠ¡å°†é‡‡ç”¨ Order å¯¹è±¡å¹¶æ‰§è¡ŒæœåŠ¡æ–¹æ³•ã€‚ç„¶åæˆ‘ä»ä¸­å–å‡º captor çš„å€¼å¹¶ä¸å®é™…å€¼è¿›è¡Œæ¯”è¾ƒã€‚

[source,java]
----
Order orderCreated = orderArgumentCaptor.getValue();
assertEquals("john", orderCreated.getBuyer());
----

ğŸ‘‰ âœ”ï¸ è®©æˆ‘ä»¬ç¼–å†™ä¸€ä¸ªç”¨äº**åˆ é™¤è®¢å•**çš„æœåŠ¡æµ‹è¯•ã€‚
è¿™é‡Œä¹Ÿéµå¾ªç›¸åŒçš„ä»£ç ï¼Œå°±åƒæˆ‘ä»¬æµ‹è¯• POST æœåŠ¡æ–¹æ³•ä¸€æ ·ã€‚
åœ¨è¿™é‡Œï¼ŒArgumentCaptor çš„ç±»å‹è¢«è§†ä¸º Longï¼Œå› ä¸ºæœåŠ¡æ–¹æ³•æ¥å— Long IDã€‚
æ­£å¦‚æˆ‘ä»¬ä¹‹å‰æ‰€åšçš„é‚£æ ·ï¼Œå†æ¬¡å°† captor å€¼ä¸å®é™…å€¼è¿›è¡Œæ¯”è¾ƒï¼

[source,java]
----
@Test
public void testDeleteOrder() {
    Order order = new Order(13L, "simen", 120.0, 10);
    orderService.deleteOrderById(order.getId());
    verify(orderService, times(1)).deleteOrderById(order.getId());
    ArgumentCaptor<Long> orderArgumentCaptor = ArgumentCaptor.forClass(Long.class);
    verify(orderService).deleteOrderById(orderArgumentCaptor.capture());
    Long orderIdDeleted = orderArgumentCaptor.getValue();
    assertNotNull(orderIdDeleted);
    assertEquals(13L, orderIdDeleted);
}
----

ç°åœ¨æœåŠ¡çš„åŸºæœ¬æµ‹è¯•ç”¨ä¾‹å·²ç»å®Œæˆ! â¤ï¸

ç°åœ¨è¿è¡Œæµ‹è¯•ç±»å¹¶æŸ¥çœ‹ç»“æœâ€¦ ğŸ’ª å…¨éƒ¨é€šè¿‡! ğŸ˜